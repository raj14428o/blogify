<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./partials/head') %>
  <title><%= blog.title %></title>
</head>

<body>
  <%- include('./partials/nav') %>

  <div class="container mt-4">
    <h1><%= blog.title %></h1>
    <img src="<%= blog.coverImageURL %>" width="700px" class="img-fluid" alt="Blog Cover">

    <div id="blog-content" class="mt-3"></div>

    
<script type="module">
  import { marked } from 'https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js';
  import DOMPurify from 'https://cdn.jsdelivr.net/npm/dompurify@3.0.5/+esm';

  // ‚úÖ Grab raw markdown from a hidden <script> tag
  const rawMarkdown = document.getElementById('raw-markdown').textContent;

  const safeHTML = DOMPurify.sanitize(marked.parse(rawMarkdown));
  document.getElementById('blog-content').innerHTML = safeHTML;
</script>

<!-- ‚úÖ Hidden container for raw markdown -->
<script type="text/plain" id="raw-markdown">
  <%- blog.body %>
</script>


    <div class="container mt-4">
      <img src="<%= blog.createdBy.profileImageUrl %>" width="50px" style="border-radius:50%">
      <%= blog.createdBy.fullName %>
    </div>
    <div class="mt-3">
    <a href="/blog/<%= blog._id %>/edit" class="btn btn-warning btn-sm">‚úèÔ∏è Edit</a>

    <form action="/blog/<%= blog._id %>?_method=DELETE" method="POST" style="display:inline;">
      <button class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this blog?')">üóëÔ∏è Delete</button>
    </form>
  </div>
    <div class="container mt-3">
      <h1>Comments (<%= comments.length %>)</h1>

      <% if (locals.user) { %>
      <form action="/blog/comment/<%= blog._id %>" method="post">
        <div class="mb-3">
          <input type="text" name="content" class="form-control" placeholder="Enter your comment">
          <button class="btn btn-sm btn-primary">Add</button>
        </div>
      </form>
      <% } %>

      <% if (locals.user && locals.user._id.toString() === blog.createdBy._id.toString()) { %>
  
<% } %>

      <div class="mt-3">
        <% comments.forEach(comment => { %>
        <div class="mb-2">
          <img src="<%= comment.createdBy.profileImageUrl %>" width="30px" style="border-radius:50%">
          <strong><%= comment.createdBy.fullName %>:</strong>
          <pre style="display:inline;">     
               <%= comment.content %></pre>
        </div>
        <% }) %>
      </div>
    </div>
  </div>

  <%- include('./partials/scripts') %>
</body>
</html>



