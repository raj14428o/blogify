<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./partials/head') %>
  <title><%= blog.title %></title>

  <style>
    /* ===== Avatar Styles ===== */
    .author-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      background-color: #e5e7eb;
    }

    .comment-avatar {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      object-fit: cover;
      background-color: #e5e7eb;
    }

    /* ===== Profile Link Styling ===== */
    .profile-link {
      text-decoration: none;
      color: inherit;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .profile-link:hover strong {
      text-decoration: underline;
    }
  </style>
</head>

<body>
  <%- include('./partials/nav') %>

  <div class="container mt-4">
    <h1><%= blog.title %></h1>

    <img 
      src="<%= blog.coverImageURL %>" 
      width="700px" 
      class="img-fluid"
      alt="Blog Cover"
    >

    <div id="blog-content" class="mt-3"></div>

    <!-- Markdown Rendering -->
    <script type="module">
      import { marked } from 'https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js';
      import DOMPurify from 'https://cdn.jsdelivr.net/npm/dompurify@3.0.5/+esm';

      const rawMarkdown = document.getElementById('raw-markdown').textContent;
      const safeHTML = DOMPurify.sanitize(marked.parse(rawMarkdown));
      document.getElementById('blog-content').innerHTML = safeHTML;
    </script>

    <script type="text/plain" id="raw-markdown">
      <%- blog.body %>
    </script>

    <!-- ‚úÖ Author Info (Clickable) -->
    <div class="container mt-4">
      <a 
        href="/user/profile/<%= blog.createdBy._id %>" 
        class="profile-link"
      >
        <img 
          src="<%= blog.createdBy.profileImageUrl %>" 
          alt="Author"
          class="author-avatar"
        >
        <strong><%= blog.createdBy.fullName %></strong>
      </a>
    </div>

    <!-- Blog Actions -->
    <div class="mt-3">
      <a href="/blog/<%= blog._id %>/edit" class="btn btn-warning btn-sm">
        ‚úèÔ∏è Edit
      </a>

      <form 
        action="/blog/<%= blog._id %>?_method=DELETE" 
        method="POST" 
        style="display:inline;"
      >
        <button 
          class="btn btn-danger btn-sm"
          onclick="return confirm('Are you sure you want to delete this blog?')"
        >
          üóëÔ∏è Delete
        </button>
      </form>
    </div>

    <!-- Comments Section -->
    <div class="container mt-3">
      <h1>Comments (<%= comments.length %>)</h1>

      <% if (locals.user) { %>
        <form action="/blog/comment/<%= blog._id %>" method="post">
          <div class="mb-3">
            <input 
              type="text" 
              name="content" 
              class="form-control"
              placeholder="Enter your comment"
            >
            <button class="btn btn-sm btn-primary mt-2">Add</button>
          </div>
        </form>
      <% } %>

      <div class="mt-3">
        <% comments.forEach(comment => { %>
          <div class="mb-2 d-flex align-items-start gap-2">

            <a 
              href="/user/profile/<%= comment.createdBy._id %>" 
              class="profile-link"
            >
              <img 
                src="<%= comment.createdBy.profileImageUrl %>" 
                alt="Comment Author"
                class="comment-avatar"
              >
            </a>

            <div>
              <a 
                href="/user/profile/<%= comment.createdBy._id %>" 
                class="profile-link"
              >
                <strong><%= comment.createdBy.fullName %></strong>
              </a>
              <pre style="display:inline; margin:0;">
<%= comment.content %>
              </pre>
            </div>
          </div>
        <% }) %>
      </div>
    </div>
  </div>

  <%- include('./partials/scripts') %>
</body>
</html>








